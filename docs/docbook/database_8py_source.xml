<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<section xmlns="http://docbook.org/ns/docbook" version="5.0" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="_database_8py_source" xml:lang="en-US">
<title>database.py</title>
<indexterm><primary>systems/database.py</primary></indexterm>
Go to the documentation of this file.<programlisting linenumbering="unnumbered"><anchor xml:id="_database_8py_source_1l00001"/><link linkend="_namespacesystems">00001</link> <emphasis role="keyword">import</emphasis>&#32;json
<anchor xml:id="_database_8py_source_1l00002"/>00002 <emphasis role="keyword">import</emphasis>&#32;os.path&#32;<emphasis role="keyword">as</emphasis>&#32;path
<anchor xml:id="_database_8py_source_1l00003"/>00003 <emphasis role="keyword">from</emphasis>&#32;.item&#32;<emphasis role="keyword">import</emphasis>&#32;Item
<anchor xml:id="_database_8py_source_1l00004"/>00004 <emphasis role="keyword">from</emphasis>&#32;.recipe&#32;<emphasis role="keyword">import</emphasis>&#32;Recipe,&#32;RecipeBook
<anchor xml:id="_database_8py_source_1l00005"/><link linkend="_classsystems_1_1database_1_1_database">00005</link> <emphasis role="keyword">class&#32;</emphasis><link linkend="_classsystems_1_1database_1_1_database">Database</link>(object):
<anchor xml:id="_database_8py_source_1l00006"/><link linkend="_classsystems_1_1database_1_1_database_1ae88b2cf4bfd42a0f97126c3888b08093">00006</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">def&#32;</emphasis><link linkend="_classsystems_1_1database_1_1_database_1ae88b2cf4bfd42a0f97126c3888b08093">__init__</link>(
<anchor xml:id="_database_8py_source_1l00007"/>00007 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;self,
<anchor xml:id="_database_8py_source_1l00008"/>00008 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;directory=&apos;data&apos;,&#32;
<anchor xml:id="_database_8py_source_1l00009"/>00009 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;item_fp=&apos;items.json&apos;,&#32;
<anchor xml:id="_database_8py_source_1l00010"/>00010 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;recipe_fp=&apos;recipes.json&apos;
<anchor xml:id="_database_8py_source_1l00011"/>00011 &#32;&#32;&#32;&#32;):
<anchor xml:id="_database_8py_source_1l00012"/><link linkend="_classsystems_1_1database_1_1_database_1a1f56514ed45936404077190fd9ee2629">00012</link> &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;self.directory,&#32;self.items_fp,&#32;self.<link linkend="_classsystems_1_1database_1_1_database_1a1f56514ed45936404077190fd9ee2629">recipes_fp</link>&#32;=&#32;directory,&#32;item_fp,&#32;recipe_fp
<anchor xml:id="_database_8py_source_1l00013"/>00013 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">#&#32;self.item_list&#32;=&#32;self.load_items_from_file()</emphasis>
<anchor xml:id="_database_8py_source_1l00014"/><link linkend="_classsystems_1_1database_1_1_database_1a4479a0266adc641b4dd623e598e02930">00014</link> &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;self.<link linkend="_classsystems_1_1database_1_1_database_1a4479a0266adc641b4dd623e598e02930">items</link>&#32;=&#32;{}
<anchor xml:id="_database_8py_source_1l00015"/><link linkend="_classsystems_1_1database_1_1_database_1a313a714187f831c4189f9fd1a0172b85">00015</link> &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;self.<link linkend="_classsystems_1_1database_1_1_database_1a313a714187f831c4189f9fd1a0172b85">recipes</link>&#32;=&#32;{}
<anchor xml:id="_database_8py_source_1l00016"/><link linkend="_classsystems_1_1database_1_1_database_1ab3eabc6aaa2da62eff414212c02f863a">00016</link> &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;self.<link linkend="_classsystems_1_1database_1_1_database_1ab3eabc6aaa2da62eff414212c02f863a">quests</link>&#32;=&#32;{}
<anchor xml:id="_database_8py_source_1l00017"/><link linkend="_classsystems_1_1database_1_1_database_1a861fb193432574ae949fc41f5c4b6061">00017</link> &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;self.<link linkend="_classsystems_1_1database_1_1_database_1a861fb193432574ae949fc41f5c4b6061">people</link>&#32;=&#32;{}
<anchor xml:id="_database_8py_source_1l00018"/><link linkend="_classsystems_1_1database_1_1_database_1a556438deefc016bfc1d19a58ba2abb5b">00018</link> &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;self.<link linkend="_classsystems_1_1database_1_1_database_1a556438deefc016bfc1d19a58ba2abb5b">locations</link>&#32;=&#32;{}
<anchor xml:id="_database_8py_source_1l00019"/>00019 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">#&#32;self.recipe_list&#32;=&#32;self.load_recipes_from_file()</emphasis>
<anchor xml:id="_database_8py_source_1l00020"/>00020 
<anchor xml:id="_database_8py_source_1l00021"/>00021 
<anchor xml:id="_database_8py_source_1l00022"/><link linkend="_classsystems_1_1database_1_1_database_1a2524a54db20049100293d4e8acf11b34">00022</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">def&#32;</emphasis><link linkend="_classsystems_1_1database_1_1_database_1a2524a54db20049100293d4e8acf11b34">verify</link>(self):
<anchor xml:id="_database_8py_source_1l00023"/>00023 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;all_ids&#32;=&#32;[i.id&#32;<emphasis role="keywordflow">for</emphasis>&#32;i&#32;<emphasis role="keywordflow">in</emphasis>&#32;self.<link linkend="_classsystems_1_1database_1_1_database_1a4479a0266adc641b4dd623e598e02930">items</link>.values()&#32;+&#32;self.<link linkend="_classsystems_1_1database_1_1_database_1a313a714187f831c4189f9fd1a0172b85">recipes</link>.values()&#32;+&#32;self.<link linkend="_classsystems_1_1database_1_1_database_1ab3eabc6aaa2da62eff414212c02f863a">quests</link>.values()&#32;+&#32;self.<link linkend="_classsystems_1_1database_1_1_database_1a861fb193432574ae949fc41f5c4b6061">people</link>.values()&#32;+&#32;self.<link linkend="_classsystems_1_1database_1_1_database_1a556438deefc016bfc1d19a58ba2abb5b">locations</link>.values()]
<anchor xml:id="_database_8py_source_1l00024"/>00024 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;dupes&#32;=&#32;[(i,&#32;all_ids.count(1))&#32;<emphasis role="keywordflow">for</emphasis>&#32;i&#32;<emphasis role="keywordflow">in</emphasis>&#32;all_ids&#32;<emphasis role="keywordflow">if</emphasis>&#32;all_ids.count(i)&#32;&gt;&#32;1]
<anchor xml:id="_database_8py_source_1l00025"/>00025 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>&#32;len(dupes)&#32;&gt;&#32;0:
<anchor xml:id="_database_8py_source_1l00026"/>00026 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">raise</emphasis>&#32;ValueError(<emphasis role="stringliteral">&quot;\n&quot;</emphasis>.join([<emphasis role="stringliteral">&quot;ID:&#32;{}&#32;occurs&#32;{}&#32;times&#32;in&#32;Database&quot;</emphasis>.format(i[0],&#32;i[1])&#32;<emphasis role="keywordflow">for</emphasis>&#32;i&#32;<emphasis role="keywordflow">in</emphasis>&#32;dupes]))
<anchor xml:id="_database_8py_source_1l00027"/>00027 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;
<anchor xml:id="_database_8py_source_1l00028"/>00028 
<anchor xml:id="_database_8py_source_1l00029"/><link linkend="_classsystems_1_1database_1_1_database_1ae9390d3807a6a781fb7914480fc65186">00029</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">def&#32;</emphasis><link linkend="_classsystems_1_1database_1_1_database_1ae9390d3807a6a781fb7914480fc65186">load_items_from_file</link>(self,&#32;file):
<anchor xml:id="_database_8py_source_1l00030"/>00030 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;data&#32;=&#32;json.load(file)
<anchor xml:id="_database_8py_source_1l00031"/>00031 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;items&#32;=&#32;{}
<anchor xml:id="_database_8py_source_1l00032"/>00032 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;i&#32;<emphasis role="keywordflow">in</emphasis>&#32;data:
<anchor xml:id="_database_8py_source_1l00033"/>00033 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;items[i[<emphasis role="stringliteral">&apos;id&apos;</emphasis>]&#32;<emphasis role="keywordflow">if</emphasis>&#32;<emphasis role="stringliteral">&apos;id&apos;</emphasis>&#32;<emphasis role="keywordflow">in</emphasis>&#32;i&#32;<emphasis role="keywordflow">else</emphasis>&#32;i[<emphasis role="stringliteral">&apos;name&apos;</emphasis>].lower()]&#32;=&#32;Item.from_dict(i)
<anchor xml:id="_database_8py_source_1l00034"/>00034 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;self.<link linkend="_classsystems_1_1database_1_1_database_1a4479a0266adc641b4dd623e598e02930">items</link>&#32;=&#32;items
<anchor xml:id="_database_8py_source_1l00035"/>00035 
<anchor xml:id="_database_8py_source_1l00036"/><link linkend="_classsystems_1_1database_1_1_database_1ad12b50fec2c22d2df20651cb48844311">00036</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">def&#32;</emphasis><link linkend="_classsystems_1_1database_1_1_database_1ad12b50fec2c22d2df20651cb48844311">load_recipes_from_file</link>(self,&#32;file):
<anchor xml:id="_database_8py_source_1l00037"/>00037 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;data&#32;=&#32;json.load(file)
<anchor xml:id="_database_8py_source_1l00038"/>00038 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;recipes&#32;=&#32;{}
<anchor xml:id="_database_8py_source_1l00039"/>00039 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;r&#32;<emphasis role="keywordflow">in</emphasis>&#32;data:
<anchor xml:id="_database_8py_source_1l00040"/>00040 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;recipes[r[<emphasis role="stringliteral">&apos;id&apos;</emphasis>]&#32;<emphasis role="keywordflow">if</emphasis>&#32;<emphasis role="stringliteral">&apos;id&apos;</emphasis>&#32;<emphasis role="keywordflow">in</emphasis>&#32;r&#32;<emphasis role="keywordflow">else</emphasis>&#32;r[<emphasis role="stringliteral">&apos;name&apos;</emphasis>].lower()]&#32;=&#32;Recipe.from_dict(r)
<anchor xml:id="_database_8py_source_1l00041"/>00041 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;self.<link linkend="_classsystems_1_1database_1_1_database_1a313a714187f831c4189f9fd1a0172b85">recipes</link>&#32;=&#32;recipes
<anchor xml:id="_database_8py_source_1l00042"/>00042 &#32;&#32;&#32;&#32;
<anchor xml:id="_database_8py_source_1l00043"/><link linkend="_classsystems_1_1database_1_1_database_1a62ca49b164a863f5f9e6538f25b3274c">00043</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">def&#32;</emphasis><link linkend="_classsystems_1_1database_1_1_database_1a62ca49b164a863f5f9e6538f25b3274c">get_item</link>(self,&#32;item_id=&apos;&apos;):
<anchor xml:id="_database_8py_source_1l00044"/>00044 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;self.item_list[item_id]
<anchor xml:id="_database_8py_source_1l00045"/>00045 
<anchor xml:id="_database_8py_source_1l00046"/><link linkend="_classsystems_1_1database_1_1_database_1aac860297aa534950d9754facfdda4848">00046</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">def&#32;</emphasis><link linkend="_classsystems_1_1database_1_1_database_1aac860297aa534950d9754facfdda4848">get_recipe</link>(self,&#32;recipe_id=&apos;&apos;):
<anchor xml:id="_database_8py_source_1l00047"/>00047 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;self.<link linkend="_classsystems_1_1database_1_1_database_1a313a714187f831c4189f9fd1a0172b85">recipes</link>[recipe_id]
<anchor xml:id="_database_8py_source_1l00048"/>00048 &#32;&#32;&#32;&#32;
<anchor xml:id="_database_8py_source_1l00049"/><link linkend="_classsystems_1_1database_1_1_database_1af7366d1383a0b983b90ced39843d98b7">00049</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">def&#32;</emphasis><link linkend="_classsystems_1_1database_1_1_database_1af7366d1383a0b983b90ced39843d98b7">get_quest</link>(self,&#32;quest_id):
<anchor xml:id="_database_8py_source_1l00050"/>00050 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">pass</emphasis>
<anchor xml:id="_database_8py_source_1l00051"/>00051 
<anchor xml:id="_database_8py_source_1l00052"/>00052 
<anchor xml:id="_database_8py_source_1l00053"/><link linkend="_classsystems_1_1database_1_1_database_1a525c46731d55ffe552df5970d5f4228b">00053</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">def&#32;</emphasis><link linkend="_classsystems_1_1database_1_1_database_1a525c46731d55ffe552df5970d5f4228b">set_items</link>(self,&#32;items):
<anchor xml:id="_database_8py_source_1l00054"/>00054 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>&#32;i&#32;<emphasis role="keywordflow">in</emphasis>&#32;items:
<anchor xml:id="_database_8py_source_1l00055"/>00055 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;self.items[i.id]&#32;=&#32;i
<anchor xml:id="_database_8py_source_1l00056"/>00056 
<anchor xml:id="_database_8py_source_1l00057"/><link linkend="_classsystems_1_1database_1_1_database_1abb44337d35c276932cade20c324f115d">00057</link> &#32;&#32;&#32;&#32;<emphasis role="keyword">def&#32;</emphasis><link linkend="_classsystems_1_1database_1_1_database_1abb44337d35c276932cade20c324f115d">__getitem__</link>(self,&#32;key):
<anchor xml:id="_database_8py_source_1l00058"/>00058 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;[i&#32;<emphasis role="keywordflow">for</emphasis>&#32;i&#32;<emphasis role="keywordflow">in</emphasis>&#32;self.<link linkend="_classsystems_1_1database_1_1_database_1a4479a0266adc641b4dd623e598e02930">items</link>.values()&#32;+&#32;self.<link linkend="_classsystems_1_1database_1_1_database_1a313a714187f831c4189f9fd1a0172b85">recipes</link>.values()&#32;+&#32;self.<link linkend="_classsystems_1_1database_1_1_database_1ab3eabc6aaa2da62eff414212c02f863a">quests</link>.values()&#32;+&#32;self.<link linkend="_classsystems_1_1database_1_1_database_1a861fb193432574ae949fc41f5c4b6061">people</link>.values()&#32;+&#32;self.<link linkend="_classsystems_1_1database_1_1_database_1a556438deefc016bfc1d19a58ba2abb5b">locations</link>.values()&#32;<emphasis role="keywordflow">if</emphasis>&#32;i.id&#32;==&#32;key][0]
</programlisting></section>
